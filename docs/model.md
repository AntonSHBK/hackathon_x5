# Модель

В качестве базовой архитектуры для задачи распознавания именованных сущностей была выбрана предобученная модель **BERT**. Однако стандартная реализация `BertForTokenClassification` из библиотеки HuggingFace была модифицирована для работы в связке с CRF-слоем. Это изменение позволило учитывать зависимости между метками в последовательности и обеспечивать более согласованные предсказания в BIO-формате.

Для этого был создан класс **`BertForTokenClassificationCRF`**, который наследует логику HuggingFace, но заменяет верхний классификатор на CRF-слой. После прохода входной последовательности через BERT-блоки выходные скрытые представления (эмбеддинги) преобразуются линейным слоем в набор логитов (`emissions`). Далее CRF-слой вычисляет вероятность наиболее вероятной последовательности меток.

Если в метод передаются `labels`, то дополнительно рассчитывается функция потерь. Для этого используется комбинация:

* CRF-лосс, который оценивает корректность предсказанной последовательности меток;
* обработка специальных значений `-100`, чтобы игнорировать токены паддинга при расчёте.

В режиме инференса применяется метод `decode` из CRF, который возвращает оптимальную последовательность меток. Для удобства предсказания приводятся к единому размеру (с помощью паддинга до максимальной длины). В итоге класс возвращает объект `TokenClassifierCRFOutput`, включающий в себя логиты, потерю, предсказания, скрытые состояния и маску внимания.
